<h1>My Appointments</h1>

<div class="mx-auto text-center">
  <%= link_to 'Back', root_path, class: "btn btn-secondary" %>
</div>

<h2>Appointments For Your Services</h2>
<div class="service-feed">
  <ul class="list-group">
    <% @booked.each do |appointment| %>
      <li class="list-group-item">
        <div class="appointment-feed-item">
          <div class="appointment-feed-title">
            <span><%= Service.find(appointment.service_id).title %></span>            
          </div>
          <div class="appointment-feed-date">
            <span><%= appointment.date.to_s %></span>            
          </div>
          <div class="appointment-feed-start">
            <span><%= appointment.start_time.strftime("%I:%M %p") %></span>
          </div>
          <div class="appointment-feed-end">
            <span><%= appointment.end_time.strftime("%I:%M %p") %></span>
          </div>
          <div class="appointment-feed-client">
            <span>Booked by: <%= User.find(appointment.user_id).username %></span>
          </div>
          <%= link_to 'Decline Appointment', 
            "#{appointment_path(appointment)}?service_id=#{appointment.service_id}&do_action=decline", 
            method: :patch, class: "btn btn-secondary",
            data: {confirm: 'Are you sure you want to decline this appointment? This appointment slot will become available.'} %>
          <%= link_to 'Cancel Appointment', 
            "#{appointment_path(appointment)}?service_id=#{appointment.service_id}", 
            method: :delete, class: "btn btn-danger",
            data: {confirm: 'Are you sure you want to cancel this appointment? This slot is already booked.'} %>
      </li>
    <% end %>
  </ul>
</div>

<h2>Services You Booked</h2>
<div class="service-feed">
  <ul class="list-group">
    <% @appointments.each do |appointment| %>
      <li class="list-group-item">
        <div class="appointment-feed-item">
          <div class="appointment-feed-title">
            <span><%= Service.find(appointment.service_id).title %></span>            
          </div>
          <div class="appointment-feed-date">
            <span><%= appointment.date.to_s %></span>            
          </div>
          <div class="appointment-feed-start">
            <span><%= appointment.start_time.strftime("%I:%M %p") %></span>
          </div>
          <div class="appointment-feed-end">
            <span><%= appointment.end_time.strftime("%I:%M %p") %></span>
          </div>
          <%= link_to 'Cancel Appointment', 
            "#{appointment_path(appointment)}?service_id=#{appointment.service_id}&do_action=cancel", 
            method: :patch, class: "btn btn-danger",
            data: {confirm: 'Are you sure you want to cancel this appointment? This slot is already booked.'} %>
        </div>
        </div>
      </li>
    <% end %>
  </ul>
</div>

<br>